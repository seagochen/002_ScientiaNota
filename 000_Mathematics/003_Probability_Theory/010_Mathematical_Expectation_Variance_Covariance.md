> 我们在学习了离散型和连续型随机概率事件，以及它们的分布函数和密度概率函数之后。接下来我们要学习对概率事件进行评判的技术——期望、方差、协方差。
> 这些概念有什么用呢，举例来说，对于一次期末考试，如何评估同一个年级的不同班级的学生的学习状况差异，如何找出年级最优班级和最差班级呢，以及在两个班级整体状况都相差不大时，如何比较一个班级学生成绩情况比另一个班级更好呢？
>  如果还记得我们前面提到过的概率分布函数，那么就可以知道这一类样本的比较，其实属于对样本的分布规律的分析。


@[toc]

# 期望 (Expectation)

只要样本遵循一定的分布，比如说打靶落入靶上的落点就一定分布在靶心周围。又比如加工一批零件，比如笔记本上常见的m2螺丝，加工出来的螺丝精度一定在标准设计尺寸上轻微浮动。

对于数学期望来说，如果统计的事件样本它本身遵循一定分布规律，那么它必然有朝着某个值收敛的特征，着这就是期望。

计算数学期望的方法其实很简单，就是算概率均值，所以在一些数学统计库（程序）里，相关的函数名字可能叫mean（均值），或者expect（期望）。

它的计算方法，对于离散和连续基本是相似的，其数学表示符号是 $E(X)$：

**离散型**

$$E(X) = \sum x_i p_i$$

$x_i$，$k_i$分别表示样本值，和样本出现概率。

**连续型**

$$E(X) = \int x f(x) dx$$


$f(x)$学了之前的章节应该认识，它就是概率密度。


# 方差 (Variance / Square Difference)

我们用期望，计算样本通常收敛在什么值的范围，自然还需要关心样本之间的误差范围。以最开始用来举例的班级期末考试为例，学校需要知道某个年级的A，B，C，D四个班级成绩情况，如果计算期望后，发现它们都收敛在80分左右，那么就需要另外一个指标帮助判断各班级的学习情况


![在这里插入图片描述](https://img-blog.csdnimg.cn/8cdfb89dff814dd3b261955a34e44faf.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BvaXNvbmNocnk=,size_16,color_FFFFFF,t_70#pic_center)

在期望都是80分的情况下，学生们的成绩越接近，说明班级同学的差异越少。反之，则说明班级里有学习特别好的人和特别差的人，对于成绩好的学生他们有可能有参加额外的课外补习，而成绩差的有可能放学后放羊的更多。

对于前一种情况，我们从学校的角度来看，说明该班级的负责老师，教育水平不错，管理能力也不错，学生们受到了足够且充分的教育。而后一种情况，既有可能是老师的水平不行，也有可能是班级同学间的家庭差异过大导致的异常。

那么从数学上，一眼看出两组样本在统计上的差异，通常就会用到所谓方差的概念。

Variance 的英文语义是值的样本差异，而方差则是国内根据样本计算方法给予的命名，即平方差，样本与期望之间差的平方，计算方式也大体上差不多。

**离散型**

$$D(X) = \sum (x_i - \mu)^2 $$

**连续型**

$$D(X) = \int (x - \mu)^2 f(x) dx$$


$\mu$ 在这里都表示期望。此外，我们有一个快速计算方差的公式：

$$D(X) = E(X^2) - E^2(X)$$

即：平方的期望减去期望的平方。


## 均方差（Mean Variance / Mean Square）

此外，从方差还引申出均方差的概念，也就是对方差算平均值，在随机下降算法中被应用在评判模型与观测值的误差程度。


$$D(\bar{X}) = \frac{D(X)}{n} $$

## 标准差（Standard Deviation）

方差的开根号形式，记得好像中学教材中用的挺多，但是对于科研和实际工作中因为其形式就是方差的开根号形式，所以反而不常用。**数学符号通常用 $\sigma$表示，方差的数学符号通常用 $\sigma^2$，均方差在传统的数学论文中不怎么常见，所以印象中好像没有专门的符号表示，而在AI领域的论文中通常以简写MSE（Mean Square Equation）或者（Mean Square Error）即均方差误差，形式表示。**

> 另外补充一点，在算法、数据挖掘、AI等领域中，PDF不是指那个看文件的软件，通常指概率密度函数（ Probability Density Function）。你看，没用的知识点是不是又增加了一点？

$$\sigma = \sqrt{D(X)} = \sqrt{\sigma^2}$$


## 关于期望、方差数学符号表示需要注意的一点

另外多说一点，就是在一些论文或者之前提到过的[《五种重要的概率分布模型》](https://seagochen.blog.csdn.net/article/details/118757136) 中，期望有时候又被写成 $\lambda$，	而方差一般习惯性用 $\sigma ^2$ 进行表示，因此对于标准差，就是 $\sigma$ 了。

苏联体系、英美体系在很多科学技术上符号的应用上很多没有得到有效的统一（这不仅仅在数学，物理学，电学等诸学科里都有所体现），或者形成个统一的世界规范。这对于做科研，比如在阅读文献的时候会造成一定的混淆。

所以，这要求我们在学习这些知识时，一定要理解公式背后的数学含义。而不能简简单单的死记公式。


# 协方差(Covariance / Correlation Coefficient)

方差是协方差的一种，不过协方差更多的是表示两个变量的变化趋势是否一致。也就是说如果其中一个大于自身的期望值，另外一个也大于自身的期望值，那么两个变量之间的协方差就是正值。 如果两个变量的变化趋势相反，即其中一个大于自身的期望值，另外一个却小于自身的期望值，那么两个变量之间的协方差就是负值。

![在这里插入图片描述](https://img-blog.csdnimg.cn/13c6d571a45a44edaa3e102511b92e15.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BvaXNvbmNocnk=,size_16,color_FFFFFF,t_70#pic_center)

协方差的计算公式为：

$Cov(X, Y) = (X - \mu_x)(Y - \mu_y)$

或者

$Cov(X, Y) = [X - E(X)][Y- E(Y)]$ 也就是X和Y分别与它的期望的差的积。

而从协方差中会得到引申，就是关联系数，即：

$$\rho = \frac{Cov(X, Y)}{\sigma_x \sigma_y}$$

这里的 $\sigma$ 是标准差的意思，还有另外的一个表达形式：

$$\rho = \frac{Cov(X, Y)}{\sqrt{D(X)} \sqrt{D(Y)}}$$

这里都是一个意思，只是表达形式上的差异。它有几个等式，其实非常容易推导并证明，你只要把这几个符号代表的函数式代入就能得到了。

1.  $Cov(X, Y) = Cov(Y, X)$
2. $Cov(X, X) = D(X)$
3. $D(X+Y) = D(X) + D(Y) + 2Cov(X, Y)$
4. $Cov(X, Y) = E(XY) - E(X)E(Y)$


最后，来做一点题吧

# 例题

## 例1
> 设一电路中电流 $I(A)$ 与电阻 $R(\Omega)$ 是两个相互独立的随机变量，其概率密度分别为：
> $$g(i) = \left \{ \begin{matrix} 
2i & 0 \leq i \leq 1 \\
0 & else
\end{matrix} \right.$$ 
> $$h(r) = \left \{ \begin{matrix}
\frac{r^2}{9} & 0 \leq r \leq 3 \\
0 & else
\end{matrix} \right.$$
> 试求电压V=IR的均值。

**解** 

> 扯一点题外话，这类问题在电路中比较常见，比如说直流纹波。比如电路是通过交流电转直流后，经过交变直电路后，多少会存在纹波现象。此外，电路中因为电磁干扰，信号电路也会产生纹波现象。还有，电阻通电后，由于温度、电压变化，也会出现其伏安特性的变化。

这题比较简单，总的来说就是求期望值/均值。只要我们记得对于连续型随机变量，其均值/期望值是如何求解的公式，就能比较容易做出这道题了。

$$E(V) = E(IR) = \int i g(i)di \cdot \int r h(r)dr$$

带入题干给出的密度公式，和积分范围：

$$E(V) = \frac{2}{3} i^3 \bigg|_0^1 \cdot \frac{1}{36} r^4 \bigg |_0^3 = (\frac{2}{3})(\frac{9}{4}) = \frac{3}{2} V$$


## 例2

> 随机变量 $X$ 的分布律如下：

| X | 0 | 1 | 2 |
|--|--|--|--|
| P |  0.4 | 0.3 | 0.2 |

> 求 
> (1) $E(X)$; 
> (2) $Y = X^2$， 求 E(Y);
> (3) D(X)

**解（1）**， 第一题很简单，直接带入离散型的期望公式

$$E(X) = \sum x_i p_i = 0 * 0.4 + 1 * 0.3 + 2 * 0.2 = 0.9$$

**解（2）**，这题跟我们之前做离散型的分布律是一样的，先写出Y的分布律

| X | 0  | 1 | 2 |
|--|--|--|--|
| Y | 0  | 1 | 4 |
| P | 0.4 | 0.3 | 0.3

所以 

$$E(Y) = 0 * 0.4 + 1 * 0.3 + 4 * 0.3 = 1.5$$

**解（3）**，我们直接引用公式 $D(X) = E(X^2) - E^2(X)$，所以有：

$$D(X) = 1.5 - 0.9^2 = 0.69$$


# 常用分布的数学期望和方差

再就是这个别人总结的常用数学期望和方差表

![在这里插入图片描述](https://img-blog.csdnimg.cn/6b278e7884f448b9b30fa8e0b797a755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BvaXNvbmNocnk=,size_16,color_FFFFFF,t_70#pic_center)

还有就是期望和方差的一些计算公式，如果记不住也没关系，可以直接用公式快速的推导。
![在这里插入图片描述](https://img-blog.csdnimg.cn/828e8f652ca54185bcc37e670eb6a017.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BvaXNvbmNocnk=,size_16,color_FFFFFF,t_70#pic_center)

> 这是一个非常重要的知识，我这倒不是说考试会如何关照这个知识点。而是说如果你想进一步深入数据科学的领域，就会在很多论文、模型里发现大量用于评判模型和分析样本关联度特征时，会经常用到协方差的概念。这也是为什么我在上一章节里提到协方差后，在这一章里还会做一点补充说明的原因。

@[toc]

# 关于协方差的一个实际生活例子

首先回顾一下协方差的公式

$$Cov(X, Y) = (X - E(X))(Y - E(Y))$$

及其相关系数

$$\rho = \frac{Cov(X, Y)}{ \sqrt{D(X)} \sqrt{D(Y)}}$$

以及数据关联特征

![在这里插入图片描述](https://img-blog.csdnimg.cn/13c6d571a45a44edaa3e102511b92e15.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BvaXNvbmNocnk=,size_16,color_FFFFFF,t_70#pic_center)

我们这里举个例子，说明协方差到底是来做什么的。

比方说，在银行风控系统中，抵押人可能有这么一些数据指标，比如说年龄、性别、学历、抵押资产（固定资产、现金、证券期票、跟其他债务人的借据等），你作为一个银行的工作人员，在确保抵押人的资料真实可信的前提下，你如何确定放贷给某个人的资金是安全的，或者大概率是安全的？


你可能需要一些资料帮助你做出这个判断。比如说银行历史上违约情况进行分析。那么从历史上，贷款人的学历，有博士、硕士、本科、高中以及其他，月收入有>50000，20000 < X < 50000, 10000 <  X < 20000等多个不同档的数据。

比方说，你 令 $X = 学历$, 令$Y = 违约率$。那么我们可以通过协方差计算每一个样本的情况：

$$Cov(X, Y) = [X - \bar{X}] [Y - \bar{Y}]$$

然后把样本计算的结果加起来，$Cov_1 + Cov_2 + \cdots + Cov_n$ 这样可以得到一个值，比如K。

如果 $K > 0$， 说明样本之间成正相关；
如果$K < 0$，说明样本之间成负相关；
如果$K \approx 0$，说明样本之间不相关。

这样，对历史样本进行统计后，你可能就会得到这样一个知识：

> 如果贷款人，有高学历、高收入，高的抵押资产，那么他的违约概率是极低的，而低收入、低学历、低资产的贷款人，违约风险极高。这样，在你审批的时候，就能通过这些条件快速的筛选合适的贷款人，尽最大可能性避免贷款出现违约风险。


# 一些协方差用到的推广公式

$$Cov(X, Y) = Cov(Y, X)$$

$$Cov(X, X) = D(X)$$

$$Cov(X, C) = 0$$

$$Cov(aX, bY) = ab \cdot Cov(X, Y)$$

$$Cov(X_1 + X_2, Y) = Cov(X_1, Y) + Cov(X_2 , Y)$$

$$Cov(X,Y)=E(XY)−E(X)E(Y)$$


# 做点题吧
>  设X， Y为随机变量，D(X) = 25, D(Y) = 16，Cov(X, Y) = 8，则 $\rho = ？$

**解：**

$$\rho = \frac{Cov(X, Y)}{\sqrt{D(X) \sqrt{D(Y)}}} = \frac{8}{\sqrt{25} \sqrt{16}} = \frac{2}{5}$$

----

> 已知二元离散型随机变量 $(X, Y)$ 的联合分布如下：

X\Y |  -1 | 1 | 2 
----|---|---|---
-1   | 0.1  | 0.2 | 0.3
2   | 0.2  | 0.1 | 0.1
> (1) X和Y的边缘分布律
> (2) X和Y的相关系数

**解（1）** 根据我们之前对于离散型二维随机变量的知识点，可以知道

X | -1 |  2
--|---|----
P |  0.6 | 0.4

Y | -1 | 1  | 2
--|---|---|---
P | 0.3 | 0.3 | 0.4


**解（2）** X和Y的相关系数，最重要的就是求解出D和E分别是多少。解题方式有两种，第一种是一个一个的算，但这样比较耗费时间，第二种就是直接带入公式求解，我们选择第二种。

相关系数方程是 $\rho = \frac{Cov(X, Y)}{ \sqrt{D(X)} \sqrt{D(Y)}}$

从上表，我们可以直接得到：

$$E(X) = -1 \times 0.6 + 2 \times 0.4 = 0.2$$
$$E(X^2) = (-1)^2 \times 0.6 + 2^2 \times 0.4 = 2.2$$
$$D(X) = E(X^2) - E^2(X) = 2.2 - 0.04 = 2.16$$

然后对于Y来说，同样可以：

$$E(Y) = -1 \times 0.3 + 1 \times 0.3 + 2 \times 0.4 = 0.8$$
$$E(Y^2) = (-1)^2 \times 0.3 + 1^2 \times 0.3 + 2^2 \times 0.4 = 2.2$$
$$D(Y) = E(Y^2) - E^2(Y) = 2.2 - 0.64 = 1.56$$

此外：

$$Cov(X, Y) = E(XY) - E(X)E(Y)$$ 而对于E(XY)来说，你可以令XY = Z，所以对于表来说，就可以变成

Z  |  Z(-1, -1) | Z(-1, 1) | Z(-1,2)  | Z(2, -1) | Z(2, 1) | Z(2, 2)
---|----------|--------|--------|---------|--------|--------
P  | 0.1           | 0.2       | 0.3        | 0.2         | 0.1       | 0.1

由于Z = X Y，所以

E(Z) = -0.5

那么 

$$\rho = \frac{-05 - 0.2 \times 0.8}{\sqrt{2.16} \sqrt{1.56} }$$

用计算器算一算，就可以得到：-0.3595